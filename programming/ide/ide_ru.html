<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1251">
	<title>Open-PLC</title>
	<link href="logo.ico" rel="shortcut icon" type="image/x-icon">
	<link href="logo.ico" rel="apple-touch-icon" sizes="">
	<META NAME="CHANGEDBY" CONTENT="Alexander Suvorov">
	<STYLE TYPE="text/css">
	<!--
		@page { size: 21cm 29.7cm; margin-left: 2cm; margin-right: 1cm; margin-top: 1cm; margin-bottom: 1cm }
		P { margin-bottom: 0cm }
		H2 { margin-left: 2.28cm; text-indent: -0.76cm; margin-top: 0cm; margin-bottom: 0cm; page-break-after: avoid }
		H2.western { font-family: "Times New Roman", serif; font-size: 20pt; font-style: normal; font-weight: bold }
		H2.cjk { font-family: "SimSun"; font-size: 14pt; font-style: italic; font-weight: bold }
		H2.ctl { font-family: "Mangal"; font-size: 14pt; font-style: italic; font-weight: bold }
		PRE.western { font-family: "Courier New", monospace; font-size: 10pt }
		PRE.cjk { font-family: "NSimSun", monospace; font-size: 10pt }
		PRE.ctl { font-family: "Courier New", monospace; font-size: 10pt }
		CODE.western { font-family: "Courier New", monospace }
		CODE.cjk { font-family: "NSimSun", monospace }
		CODE.ctl { font-family: "Courier New", monospace }
		A:link { color: #000080; so-language: zxx; text-decoration: underline }
		A:visited { color: #800000; so-language: zxx; text-decoration: underline }
	-->
	</STYLE>
</HEAD>
<BODY LANG="ru-RU" LINK="#000080" VLINK="#800000" BGCOLOR="#f0f8ff" DIR="LTR">
<TABLE WIDTH=100% BORDER=0 CELLPADDING=0 CELLSPACING=0 STYLE="page-break-before: always">
	<COL WIDTH=6*>
	<COL WIDTH=250*>
	<TR>
		<TD COLSPAN=2 WIDTH=100% VALIGN=TOP>
			<P ALIGN=LEFT STYLE="background: #cccccc"><IMG SRC="images/logo.png" NAME="f001" ALIGN=BOTTOM WIDTH=398 HEIGHT=76 BORDER=0></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=2%>
			<P STYLE="background: #cccccc"><BR>
			</P>
		</TD>
		<TD WIDTH=98%>
			<P ALIGN=CENTER STYLE="background: #b3b3b3"><FONT SIZE=6><B>Среда
			разработки</B></FONT></P>
		</TD>
	</TR>
</TABLE>
<P><BR>
</P>
<P><FONT SIZE=4><A HREF="../../programming_p1.html">Оглавление</A></FONT></P>
<P><BR>
</P>
<H2 CLASS="western"> Введение</H2>
<P ALIGN=LEFT STYLE="margin-right: 11cm; page-break-before: auto"><FONT FACE="Times New Roman, serif"><FONT SIZE=4><FONT SIZE=4 STYLE="font-size: 16pt">Микроконтроллеры
AVR, используемые в Arduino привлекают своей простотой. Но в
определенный момент возникает ситуация, когда мощности этих
микроконтроллеров не хватает. Тогда обращают внимание на
микроконтроллеры ARM. Наибольшее распространение имеет отладочная
плата &quot;голубая таблетка&quot;, МК STM32F103C8T6:<BR></FONT><IMG SRC="images/blue_pill.png" NAME="blue_pill.png" ALIGN=BOTTOM WIDTH=378 HEIGHT=254 BORDER=0></FONT></FONT></P>
<P STYLE="margin-right: 11cm; page-break-before: auto"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">На
Aliexpress такую можно купить за пару долларов.</FONT></FONT></P>
<P STYLE="margin-right: 11cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">Но
&quot;быстрый старт&quot; на этом микроконтроллере как правило не
получается в силу обилия периферии и как следствие сложности в
понимании этого микроконтроллера. Прежде, чем что-то начнет на нем
работать приходится прочесть <I>datasheet</I>-ы по ARM и понять, что
же в них написано.</FONT></FONT></P>
<P STYLE="margin-right: 11cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">А
хочется, чтобы что-то сразу начало работать...</FONT></FONT></P>
<P STYLE="margin-right: 11cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">Безусловно,
есть адаптации среды разработки Arduino для &quot;голубой таблетки&quot;.
Но эти решения пока что еще достаточно &quot;сырое&quot; и не
позволяют полноценно использовать возможности микроконтроллера
STM32F103C8T6.</FONT></FONT></P>
<P STYLE="margin-right: 11cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">Попробуем
исправить это положение дел.</FONT></FONT></P>
<P STYLE="margin-right: 11cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">С
этой целью была разработана &quot;универсальная прошивка&quot; для
&quot;голубой таблетки&quot;. Цель проекта предельно снизить порог
вхождения в микроконтроллер STM32F103C8T6. По возможности сделав его
ниже, чем у Arduino. Достаточно минимальных знаний о микроконтроллере
и минимальных навыков в программировании.</FONT></FONT></P>
<P STYLE="margin-right: 11cm"><BR>
</P>
<H2 CLASS="western"> Выбор среды разработки.</H2>
<P STYLE="margin-right: 11.17cm; page-break-before: auto"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">Были
опробованы различные свободные IDE, в том числе основанные на
Eclipse.</FONT></FONT></P>
<P STYLE="margin-right: 11.17cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">Наиболее
простым и удобным показался <I><B>EmBitz</B></I>. Это клон
<I><B>Em::Blocks</B></I>. Имеет небольшой размер и после установки
сразу готов к использованию.</FONT></FONT></P>
<P STYLE="margin-right: 11.17cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4><FONT SIZE=4 STYLE="font-size: 16pt">Скачать
дистрибутив можно отсюда: </FONT><A HREF="https://www.embitz.org/EmBitz_1.11.zip"><FONT SIZE=4 STYLE="font-size: 16pt">www.embitz.org</FONT></A><FONT SIZE=4 STYLE="font-size: 16pt">
Проекты будут подготавливаться именно для этой среды разработки. Из
общих минусов среды можно отметить лишь один - нет версии под Linux.</FONT></FONT></FONT></P>
<P STYLE="margin-right: 11.17cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">Дополнительно
нужно установить утилиты<BR>STM32 ST-LINK Utility (
</SPAN></FONT></FONT><A HREF="https://www.st.com/en/development-tools/stsw-link004.html"><FONT SIZE=4>https://www.st.com/en/development-tools/stsw-link004.html</FONT></A><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">
) (</SPAN></FONT></FONT><FONT COLOR="#002052"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><SPAN STYLE="font-style: normal"><B>STSW-LINK004</B></SPAN></SPAN></FONT></FONT></FONT><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">)<BR>и
Flash Loader Demo (
</SPAN></FONT></FONT><A HREF="https://www.st.com/en/development-tools/flasher-stm32.html"><FONT SIZE=4>https://www.st.com/en/development-tools/flasher-stm32.html</FONT></A><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">
) </SPAN></FONT></FONT><FONT COLOR="#505251"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN STYLE="font-style: normal"><B>(UM0462)<BR></B></SPAN></FONT></FONT></FONT><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">Зеркала:
</SPAN></FONT></FONT><A HREF="https://github.com/open-plc-com/open-plc/raw/master/add_sw/en.stsw-link004.zip"><FONT SIZE=4 STYLE="font-size: 16pt">STM32
ST-LINK Utility</FONT></A><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">,
</SPAN></FONT></FONT><A HREF="https://github.com/open-plc-com/open-plc/raw/master/add_sw/Flash_Loader_Demonstrator_v2_6_0.zip"><FONT SIZE=4 STYLE="font-size: 16pt">Flash
Loader Demo</FONT></A></P>
<P STYLE="margin-right: 11.17cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">Данные
утилиты будут использоваться для загрузки &quot;прошивок&quot;.</FONT></FONT></P>
<P STYLE="margin-right: 11.17cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt">После
установки <I><B>EmBitz</B></I> потребуются небольшие настройки, в
частности добавить в меню User-defined tool.</FONT></FONT></P>
<P STYLE="margin-right: 11.17cm"><FONT FACE="Times New Roman, serif"><FONT SIZE=4><FONT SIZE=4 STYLE="font-size: 16pt">Tools
-&quot; Configure tools... -&quot; Add</FONT><BR><A HREF="images/ebp01.jpg"><IMG SRC="images/ebp01.jpg" NAME="ebp01.jpg" ALIGN=BOTTOM WIDTH=643 HEIGHT=494 BORDER=0></A></FONT></FONT></P>
<P STYLE="margin-right: 11.17cm"><BR>
</P>
<P STYLE="margin-right: 11.09cm; page-break-before: auto"><FONT FACE="Times New Roman, serif"><FONT SIZE=4 STYLE="font-size: 16pt"><I><B>Flash
via ST-Link</B></I></FONT></FONT></P>
<PRE CLASS="western" STYLE="margin-right: 11.09cm; background: #e6e6e6"><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><I><B>Name</B></I></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">:        Flash via ST-Link</SPAN></FONT></CODE>
<CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">Executable:  C:\Program Files\STMicroelectronics\STM32<BR>		  ST-LINK Utility\ST-LINK Utility\ST-LINK_CLI.exe</SPAN></FONT></CODE>
<CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><I><B>Parameters</B></I></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">:  -c SWD -P &quot;${TARGET_OUTPUT_DIR}$<BR>		  {TARGET_OUTPUT_BASENAME}.hex&quot; 0x08000000 -V<BR>		  -Rst -Run</SPAN></FONT></CODE>
<CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><I><B>Working directory</B></I></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">: ${PROJECT_DIR}</SPAN></FONT></CODE></PRE><P STYLE="margin-right: 11.09cm; font-style: normal; font-weight: normal">
<BR>
</P>
<P STYLE="margin-right: 11.09cm; font-style: normal; font-weight: normal">
<FONT SIZE=4 STYLE="font-size: 16pt">Для удобства работы с
инструментом загрузки можно назначить на этот инструмент &quot;горячую
кнопку&quot;, например &quot;Alt-A&quot;.</FONT></P>
<P STYLE="margin-right: 11.09cm; font-style: normal; font-weight: normal">
<BR>
</P>
<P STYLE="margin-right: 11.09cm"><FONT SIZE=4 STYLE="font-size: 16pt"><I><B>Flash
<SPAN LANG="en-US">via </SPAN>loader demonstrator</B></I></FONT></P>
<PRE CLASS="western" STYLE="margin-right: 11.09cm; background: #e6e6e6"><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><I><B>Name</B></I></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">:        Flash loader demonstrator<BR>		  Executable:  </SPAN></FONT></CODE><CODE CLASS="western"><A HREF="../../../../../../../Program">C:\Program</A></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><BR>		  Files\STMicroelectronics\Software\Flash Loader<BR>		  Demonstrator\STMFlashLoader.exe</SPAN></FONT></CODE>
<CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><I><B>Parameters</B></I></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><SPAN STYLE="font-style: normal"><SPAN STYLE="font-weight: normal">:</SPAN></SPAN></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">  -c --pn 14 --br 115200 --to 3000 -i STM32<BR>		  Med-density-value_64K -e --all -d --o --fn &quot;$<BR>		  {TARGET_OUTPUT_DIR}$<BR>		  {TARGET_OUTPUT_BASENAME}.hex&quot; -p --drp</SPAN></FONT></CODE>
<CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU"><I><B>Working directory</B></I></SPAN></FONT></CODE><CODE CLASS="western"><FONT SIZE=4 STYLE="font-size: 16pt"><SPAN LANG="ru-RU">: ${PROJECT_DIR}</SPAN></FONT></CODE></PRE><P STYLE="margin-right: 11.09cm">
<FONT SIZE=4 STYLE="font-size: 16pt">Параметр - &quot;pn&quot; это
номер COM-порта. Необходимо ввести тот, который связан с USB-UART
адаптером. В примере это <SPAN LANG="en-US">COM14.</SPAN></FONT></P>
<P STYLE="margin-right: 11.09cm"><FONT SIZE=4 STYLE="font-size: 16pt">При
использовании UART1 для &quot;прошивки&quot; и одновременной работы с
терминалом <SPAN LANG="en-US">TerraTerm</SPAN>, сначала нужно
освободить терминал. В <SPAN LANG="en-US">TerraTerm</SPAN> Нажать
Ctrl-I, после окончания загрузки, для подключения терминала <SPAN LANG="en-US">&mdash;</SPAN>
Ctrl-N.</FONT></P>
<P STYLE="margin-right: 11.09cm"><BR>
</P>
<P STYLE="margin-right: 11.09cm"><FONT SIZE=4 STYLE="font-size: 16pt">Hot
key:</FONT></P>
<P STYLE="margin-right: 11.09cm"><FONT SIZE=4><FONT SIZE=4 STYLE="font-size: 16pt">Setting
- Environment</FONT><BR><A HREF="../../../../../_002_start/_site/articles/_programming/b002_ide/images/ebp02.jpg"><IMG SRC="images/ebp02.jpg" NAME="ebp02.jpg" ALIGN=BOTTOM WIDTH=643 HEIGHT=470 BORDER=0></A></FONT></P>
<P STYLE="margin-right: 11.09cm; page-break-before: auto"><FONT SIZE=4><FONT SIZE=4 STYLE="font-size: 16pt">При
успешной загрузке прошивки в микроконтроллер увидим примерно такую
картинку:</FONT><BR><IMG SRC="images/ebp03.jpg" NAME="ebp03.jpg" ALIGN=BOTTOM WIDTH=643 HEIGHT=342 BORDER=0></FONT></P>
<P><FONT SIZE=4 STYLE="font-size: 16pt">Для закрытия этого окна
нажать &quot;Enter&quot;.</FONT></P>
<P><BR>
</P>
<H2 CLASS="western"> Основные &quot;горячие кнопки&quot; EmBitz:</H2>
<TABLE WIDTH=412 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=84>
	<COL WIDTH=310>
	<TR VALIGN=TOP>
		<TD WIDTH=84>
			<P><FONT SIZE=4 STYLE="font-size: 16pt">Shift-F2</FONT></P>
		</TD>
		<TD WIDTH=310>
			<P><FONT SIZE=4 STYLE="font-size: 16pt">показать/скрыть дерево
			проекта</FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=84>
			<P><FONT SIZE=4 STYLE="font-size: 16pt">F2</FONT></P>
		</TD>
		<TD WIDTH=310>
			<P><FONT SIZE=4 STYLE="font-size: 16pt">показать/скрыть окно
			сообщений</FONT></P>
		</TD>
	</TR>
	<TR VALIGN=TOP>
		<TD WIDTH=84>
			<P><FONT SIZE=4 STYLE="font-size: 16pt">F7</FONT></P>
		</TD>
		<TD WIDTH=310>
			<P><FONT SIZE=4 STYLE="font-size: 16pt">компиляция проекта</FONT></P>
		</TD>
	</TR>
</TABLE>
<P><BR>
</P>
<P><FONT SIZE=4><A HREF="../../programming_p1.html">Оглавление</A></FONT></P>
<P><BR>
</P>
</BODY>
</HTML>